

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è¨­å®š</title>
  <link rel="stylesheet" href="./CSS/settingStyles.css" />
</head>
<body>

  <h2>æŠ½çé¸é …åˆ—è¡¨</h2>
  <div class="button-container" id="buttonContainer">
    <div class="button-row" draggable="true">
      <button class="fancy-button">å¤ä¸€çµ„</button>
      <button class="delete-button" onclick="deleteButton(this)">åˆªé™¤</button>
    </div>
    <div class="button-row" draggable="true">
      <button class="fancy-button">ä¹¾ä¸€çµ„</button>
      <button class="delete-button" onclick="deleteButton(this)">åˆªé™¤</button>
    </div>
  </div>

  <div class="input-group">
    <input type="text" id="optionName" class="name-input" placeholder="è«‹è¼¸å…¥é¸é …åç¨±" />
    <button class="add-button" onclick="addButton()">â• æ–°å¢é¸é …</button>
  </div>
  
  <div class="button-container">
    <button class="reset-button" style="display: none;" onclick="reSetting()">é‡æ–°è¨­å®š</button>
  </div>
  
  <div class="button-container">
     <button class="finish-button" onclick="finishSetting()">å®Œæˆè¨­å®š</button>
  </div>
  
      <div class="upload-section">
  <h3>ä¸Šå‚³è§’è‰²åœ–ç‰‡</h3>
<input type="file" id="imageUpload" multiple accept="image/*" style="display: none;" />
<div class="button-container">
<button class="selectImg" onclick="document.getElementById('imageUpload').click()">ğŸ“· é¸æ“‡åœ–ç‰‡</button>
<button class="goSelect-button" style="display: none;" id="goNext">å‰å¾€é¸æ“‡é </button>
</div>

<div id="imageArea"></div>

</div>
  



  <script>
    const container = document.getElementById("buttonContainer");
    const selectLists = ['å¤ä¸€çµ„', 'ä¹¾ä¸€çµ„'];
    const imgLists = [];
    var imageCount = 0; //åœ–ç‰‡æ•¸é‡
    let dragSrcEl = null;
    // å»ºç«‹ IndexedDB
    let db;
    const request = indexedDB.open("ImageDB", 1);

    request.onerror = function(event) {
      console.error("IndexedDB é–‹å•Ÿå¤±æ•—", event);
    };

    request.onsuccess = function(event) {
      db = event.target.result;

      // é€™è£¡åŠ æ¸…é™¤ images çš„é‚è¼¯
      const tx = db.transaction("images", "readwrite");
      const store = tx.objectStore("images");
      const clearRequest = store.clear();

      clearRequest.onsuccess = function () {
        alert("å·²æ¸…ç©º IndexedDB çš„ images è³‡æ–™");
        document.getElementById("goNext").onclick = function () {
        if (imgLists.length === 0 || imgLists.length != selectLists.length) {
          alert('è«‹é¸æ“‡è¶³å¤ çš„è§’è‰²åœ–ç‰‡ï¼'+ imgLists.length +'åœ–ç‰‡/'+ selectLists.length + ' é¸é …');
        }
        else {
          localStorage.setItem("selectLists", JSON.stringify(selectLists));
          window.location.href='selectionPage.html'
        }
    };
      };

      clearRequest.onerror = function (event) {
        console.error("æ¸…é™¤ IndexedDB å¤±æ•—", event);
      };
    };

    request.onupgradeneeded = function(event) {
      db = event.target.result;
      db.createObjectStore("images", { autoIncrement: true });
    };

    document.getElementById("imageUpload").addEventListener("change", function (e) {
      const files = e.target.files;

      Array.from(files).forEach(file => {
        if (file.type.startsWith("image/")) {
          const reader = new FileReader();
          reader.onload = function (event) {
            const dataURL = event.target.result;

            const img = document.createElement("img");
            img.src = dataURL;
            img.style.maxWidth = "150px";
            img.style.margin = "10px";
            document.getElementById("imageArea").appendChild(img);

            // å­˜å…¥ IndexedDB
            const tx = db.transaction("images", "readwrite");
            const store = tx.objectStore("images");
            store.add(dataURL);
            imageCount ++;
            imgLists.push(imageCount);
          };
          reader.readAsDataURL(file);
        }
      });
    });
    

    function handleDragStart(e) {
      dragSrcEl = this;
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/html', this.innerHTML);
      this.classList.add('dragging');
    }

    function handleDragOver(e) {
      if (e.preventDefault) e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      return false;
    }

    function handleDragEnter(e) {
      this.classList.add('over');
    }

    function handleDragLeave(e) {
      this.classList.remove('over');
    }

    function handleDrop(e) {
      if (e.stopPropagation) e.stopPropagation();

      if (dragSrcEl !== this) {
        // äº¤æ›æ•´å€‹ div çš„å…§å®¹
        const temp = this.innerHTML;
        this.innerHTML = dragSrcEl.innerHTML;
        dragSrcEl.innerHTML = temp;

        // é‡æ–°ç¶å®šäº‹ä»¶ï¼ˆå› ç‚º innerHTML æ›æ‰å¾Œï¼Œäº‹ä»¶æœƒæ¶ˆå¤±ï¼‰
        addDragAndDeleteHandlers(this);
        addDragAndDeleteHandlers(dragSrcEl);
      }

      return false;
    }

    function handleDragEnd(e) {
      this.classList.remove('dragging');
      const rows = container.querySelectorAll('.button-row');
      rows.forEach(row => row.classList.remove('over'));
    }

    function addDragAndDeleteHandlers(row) {
      row.setAttribute('draggable', 'true');
      row.addEventListener('dragstart', handleDragStart, false);
      row.addEventListener('dragenter', handleDragEnter, false);
      row.addEventListener('dragover', handleDragOver, false);
      row.addEventListener('dragleave', handleDragLeave, false);
      row.addEventListener('drop', handleDrop, false);
      row.addEventListener('dragend', handleDragEnd, false);

      // åˆªé™¤æŒ‰éˆ•äº‹ä»¶ä¹Ÿéœ€è¦é‡æ–°ç¶å®š
      const delBtn = row.querySelector('.delete-button');
      delBtn.onclick = () => row.remove();
    }

    // åˆå§‹åŒ–ç¾æœ‰æŒ‰éˆ•çš„æ‹–æ‹‰å’Œåˆªé™¤äº‹ä»¶
    document.querySelectorAll('.button-row').forEach(addDragAndDeleteHandlers);

    function addButton() {
      const nameInput = document.getElementById("optionName");
      const name = nameInput.value.trim();

      if (name === "") {
        alert("è«‹è¼¸å…¥æŒ‰éˆ•åç¨±ï¼");
        return;
      }

      const row = document.createElement("div");
      row.className = "button-row";
      row.setAttribute('draggable', 'true');

      const newBtn = document.createElement("button");
      newBtn.className = "fancy-button";
      newBtn.textContent = name;
      selectLists.push(name);


      const delBtn = document.createElement("button");
      delBtn.className = "delete-button";
      delBtn.textContent = "åˆªé™¤";
      delBtn.onclick = function () {
      row.remove(); // ç§»é™¤ç•«é¢ä¸Šçš„ row
      const index = selectLists.indexOf(name);
      if (index !== -1) {
        selectLists.splice(index, 1); // å¾ options é™£åˆ—ä¸­ç§»é™¤
      }
    };
      

      row.appendChild(newBtn);
      row.appendChild(delBtn);
      container.appendChild(row);

      addDragAndDeleteHandlers(row);

      nameInput.value = ""; // æ¸…ç©ºè¼¸å…¥æ¡†
    }

    function deleteButton(button) {
      const row = button.parentElement;
      row.remove();
      
    }
    //è·³è½‰é é¢
    // function goNext() {
      
    // }
  //   //åœ–ç‰‡ï¼
  // document.getElementById("imageUpload").addEventListener("change", function (e) {
  //   const imageArea = document.getElementById("imageArea");

  //   const files = e.target.files;

  //   Array.from(files).forEach(file => {
  //     if (file.type.startsWith("image/")) {
  //       const reader = new FileReader();
  //       reader.onload = function (event) {
  //          const base64 = event.target.result; // é€™æ˜¯åœ–ç‰‡çš„ base64 å­—ä¸²
  //          imgLists.push(base64);  // æŠŠ base64 å­˜é€²é™£åˆ—
        
  //         const img = document.createElement("img");
  //         img.src = event.target.result;
  //         img.style.maxWidth = "200px";
  //         img.style.margin = "10px";
  //         imageArea.appendChild(img); // æ’å…¥åˆ° HTML ä¸­
  //       };
  //       reader.readAsDataURL(file);
  //     }
  //   });
  // });

    
   // ï¼ƒï¼ƒï¼ƒé‡æ–°è¨­å®šæŒ‰éˆ•ï¼ƒï¼ƒï¼ƒ
    function reSetting() {
       // 1. é–å®šæ‰€æœ‰æŒ‰éˆ•ï¼šå–æ¶ˆ draggableï¼Œç¦ç”¨åˆªé™¤æŒ‰éˆ•ï¼Œä¸¦è®“ä¸»æŒ‰éˆ•ä¸å¯é»æ“Šï¼ˆç”¨ disabled æˆ–ç§»é™¤äº‹ä»¶ï¼‰
  const rows = container.querySelectorAll('.button-row');
  rows.forEach(row => {
    row.setAttribute('draggable', 'true'); // å–æ¶ˆæ‹–æ‹‰
    const delBtn = row.querySelector('.delete-button');
    if (delBtn) delBtn.style.display = 'block'; //é¡¯ç¤ºè—åˆªé™¤æŒ‰éˆ•

    const mainBtn = row.querySelector('.fancy-button');
    if (mainBtn) {
      mainBtn.style.cursor = 'pointer';
      mainBtn.style.opacity = '1.0';
    }
  });

  // 2. é¡¯ç¤ºæ–°å¢é¸é …å€å¡Š
  const inputGroup = document.querySelector('.input-group');
  if (inputGroup) inputGroup.style.display = 'block';

  // 3. é¡¯ç¤ºå®Œæˆè¨­å®šæŒ‰éˆ•è‡ªå·±ï¼ˆå¯é¸ï¼‰
  const finishBtn = document.querySelector('.finish-button');
  if (finishBtn) finishBtn.style.display = 'block';
  
  // 4.éš±è—é‡æ–°è¨­å®šæŒ‰éˆ•
  const resetBtn = document.querySelector('.reset-button');
  if(resetBtn) resetBtn.style.display = 'none';
  
  //5.éš±è—å‰å¾€é¸æ“‡é æŒ‰éˆ•
  const goNextBtn = document.querySelector('.goSelect-button');
  if(goNextBtn) goNextBtn.style.display = 'none';
    }
    
    // ï¼ƒï¼ƒï¼ƒå®Œæˆè¨­å®šæŒ‰éˆ•ï¼ƒï¼ƒï¼ƒ//
    function finishSetting() {
  // 1. é–å®šæ‰€æœ‰æŒ‰éˆ•ï¼šå–æ¶ˆ draggableï¼Œç¦ç”¨åˆªé™¤æŒ‰éˆ•ï¼Œä¸¦è®“ä¸»æŒ‰éˆ•ä¸å¯é»æ“Šï¼ˆç”¨ disabled æˆ–ç§»é™¤äº‹ä»¶ï¼‰
  const rows = container.querySelectorAll('.button-row');
  rows.forEach(row => {
    row.setAttribute('draggable', 'false'); // å–æ¶ˆæ‹–æ‹‰
    const delBtn = row.querySelector('.delete-button');
    if (delBtn) delBtn.style.display = 'none'; // éš±è—åˆªé™¤æŒ‰éˆ•

    const mainBtn = row.querySelector('.fancy-button');
    if (mainBtn) {
      mainBtn.style.cursor = 'default';
    }
  });


  // 2. éš±è—æ–°å¢é¸é …å€å¡Š
  const inputGroup = document.querySelector('.input-group');
  if (inputGroup) inputGroup.style.display = 'none';

  // 3. éš±è—å®Œæˆè¨­å®šæŒ‰éˆ•è‡ªå·±ï¼ˆå¯é¸ï¼‰
  const finishBtn = document.querySelector('.finish-button');
  if (finishBtn) finishBtn.style.display = 'none';
  
  // 4.é¡¯ç¤ºé‡æ–°è¨­å®šæŒ‰éˆ•
  const resetBtn = document.querySelector('.reset-button');
  if(resetBtn) resetBtn.style.display = 'block';
  
  //5.é¡¯ç¤ºå‰å¾€é¸æ“‡é 
  const goNextBtn = document.querySelector('.goSelect-button');
  if(goNextBtn) goNextBtn.style.display = 'block';
}

  </script>

</body>
</html>